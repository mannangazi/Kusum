{\rtf1\ansi\ansicpg1252\deff0\nouicompat\deflang1033{\fonttbl{\f0\fnil\fcharset0 Calibri;}}
{\colortbl ;\red0\green0\blue255;}
{\*\generator Riched20 10.0.17134}\viewkind4\uc1 
\pard\sa200\sl276\slmult1\f0\fs22\lang9 chef is configuration management system:-\par
chef transform infrasture as code.\par
chef framework is combination of chef server,node and workstation.\par
chef-client is programme is run on every node.\par
knife tool is run on workstation.\par
chef server contains configuration information is called cookbook\par
chef node pulling configuration in every 30 minute.\par
configuration is created by OHAI, in puppet it is called factor.\par
a. workstation \par
b. chef server\par
c. chef node.\par
\par
Install chef developement kit in workstation after downloading.\par
in chef-repo directory create file hello.rb\par
chef is written with ruby.\par
file 'motd' do\par
      content 'Hello World'\par
      owner 'mannan'\par
      group 'mannan'\par
      mode '0755'\par
end\par
now run command -> chef-apply hello.rb\par
it will created a file called motd with content hello world.\par
hello.rb is a receipe we place a resource called file.\par
we can place multiple resource in one receipe file when multiple \par
when we bundle those receipe we called cookbook.\par
we can delete resource\par
action 'delete'\par
vim hello.rb\par
package 'apache2'\par
\par
service 'apache2' do\par
         action [:enable, :start]\par
end\par
\par
file '/var/www/html/index.html' do\par
       owner 'www-data'\par
       group 'www-data'\par
       mode '0755'\par
       content 'Hi Mannan How r u'\par
end\par
mkdir cookbooks\par
cd cookbooks\par
chef generate cookbook leran_chef_cookbook\par
you can check by typing tree.\par
chef generate template leran_chef_apache2 index.html\par
it will create a index.html.erb under templates/default\par
just make entry there Hello world.\par
Now prepare the receipe file.'\par
vi learn_chef_apache2/receipes/default.rb\par
just make a entry like hello.rb file.\par
package 'apache2'\par
\par
service 'apache2' do\par
         action [:enable, :start]\par
end\par
\par
template '/var/www/html/index.html' do\par
          source 'index.html.erb'\par
          owner 'www-data'\par
          group 'www-data'\par
          mode '0755'\par
end\par
\par
now run the cookbook\par
chef-client --local-mode --runlist 'recipe[leran_chef_apache2]'\par
\par
login in {{\field{\*\fldinst{HYPERLINK https://manage.chef.io }}{\fldrslt{https://manage.chef.io\ul0\cf0}}}}\f0\fs22  download starter key\par
unzip it in /root/chef-repo/\par
there is supermarket.chef.io where we can get the different cookbook.\par
knife cookbook site download learn_chef_apache2 (for downloading from supermarket)\par
\par
#########authenticvation with server#####\par
Download Starter Kit from Chef Manage GUI\par
Login to Chef Manage GUI, and click on \ldblquote Administration\rdblquote  tab on the top. Next, select the organization from the list. In this example, the organization name is \ldblquote example\rdblquote . Once the organization is selected, click on \ldblquote Starter Kit\rdblquote  from the menu on the left-side as shown below.\par
\par
Chef Manage Starter Kit\par
\par
When you click on \ldblquote Download\rdblquote , you will get this warning message: Are you certain?: Your user and organization keys will be reset. Are you sure you want to do this?.\par
\par
Click on Proceed. This will download chef-starter.zip file to your local machine.\par
\par
Unzip Starter Kit\par
Transfer the chef-starter.zip file to the Chef workstation, and unzip it under root\rquote s home directory as shown below.\par
\par
# cd ~\par
# unzip chef-starter.zip \par
Archive:  chef-starter.zip\par
   creating: chef-repo/cookbooks/\par
   creating: chef-repo/cookbooks/starter/\par
   creating: chef-repo/cookbooks/starter/templates/\par
   creating: chef-repo/cookbooks/starter/templates/default/\par
  inflating: chef-repo/cookbooks/starter/templates/default/sample.erb  \par
   creating: chef-repo/cookbooks/starter/files/\par
   creating: chef-repo/cookbooks/starter/files/default/\par
  inflating: chef-repo/cookbooks/starter/files/default/sample.txt  \par
   creating: chef-repo/cookbooks/starter/recipes/\par
  inflating: chef-repo/cookbooks/starter/recipes/default.rb  \par
   creating: chef-repo/cookbooks/starter/attributes/\par
  inflating: chef-repo/cookbooks/starter/attributes/default.rb  \par
  inflating: chef-repo/cookbooks/starter/metadata.rb  \par
  inflating: chef-repo/cookbooks/chefignore  \par
  inflating: chef-repo/README.md     \par
  inflating: chef-repo/.gitignore    \par
   creating: chef-repo/.chef/\par
   creating: chef-repo/roles/\par
  inflating: chef-repo/.chef/knife.rb  \par
  inflating: chef-repo/roles/starter.rb  \par
  inflating: chef-repo/.chef/ramesh.pem  \par
  inflating: chef-repo/.chef/example-validator.pem\par
If you are manually setting up the chef-repo folder, then you need to create the above sub-directories manually, and copy the knife.rb file, organization-validator.pem file (for example: example-validator.pem), and username.pem file (for example: ramesh.pem) to the directories shown above.\par
\par
Get the Chef Server SSL Certificate\par
At this stage, if you execute knife client list, you\rquote ll get this error message as shown below: \ldblquote ERROR: SSL Validation failure connecting to host certificate verify failed\rdblquote\par
\par
# cd ~/chef-repo\par
# knife client list\par
ERROR: SSL Validation failure connecting to host: centos.example.com - SSL_connect returned=1 errno=0 state=error: certificate verify failed\par
ERROR: Could not establish a secure connection to the server.\par
Use `knife ssl check` to troubleshoot your SSL configuration.\par
If your Chef Server uses a self-signed certificate, you can use\par
`knife ssl fetch` to make knife trust the server's certificates.\par
\par
Original Exception: OpenSSL::SSL::SSLError: SSL Error connecting to {{\field{\*\fldinst{HYPERLINK https://centos.example.com/organizations/example/clients }}{\fldrslt{https://centos.example.com/organizations/example/clients\ul0\cf0}}}}\f0\fs22  - SSL_connect returned=1 errno=0 state=error: certificate verify failed\par
The certificate verify failed, because we don\rquote t have the SSL certificate downloaded from the Chef server yet.\par
\par
For this, execute the following \ldblquote knife ssl fetch\rdblquote  command as shown below.\par
\par
# cd ~/chef-repo\par
# knife ssl fetch\par
WARNING: Certificates from centos.example.com will be fetched and placed in your trusted_cert\par
directory (/root/chef-repo/.chef/trusted_certs).\par
\par
Knife has no means to verify these are the correct certificates. You should\par
verify the authenticity of these certificates after downloading.\par
This will download the certificate to the following truster_certs directory.\par
\par
# ls -l /root/chef-repo/.chef/trusted_certs\par
-rw-r--r--. 1 root root 1379 Mar 20 20:17 centos_example_com.crt\par
\par
# cat /root/chef-repo/.chef/trusted_certs/centos_example_com.crt \par
-----BEGIN CERTIFICATE-----\par
MIIDzDCCArSgAwIBAgIBADANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJVUzEQ\par
MA4GA1UECgwHWW91Q29ycDETMBEGA1UECwwKT3BlcmF0aW9uczEbMBkGA1UEAwwS\par
ZXJhdGlvbnMxGzAZBgNVBAMMEmNlbnRvcy5leGFtcGxlLmNvbTCCASIwDQYJKoZI\par
..\par
..\par
WLyr2ORLMcck/OGsubabO/koMNTqhl2JJPECNiDJh06MeZ/2+BOwGZSpXDbw+vFE\par
NJAsLfsTzihGWZ58einMFA==\par
-----END CERTIFICATE-----\par
Final Verification of Chef Workstation\par
If the chef workstation is working propely, when you execute the \ldblquote knife client list\rdblquote , it will display all the clients that are connected to this workstation. Since we just installed it, we\rquote ll see only the validator of your organization as shown below.\par
\par
# cd ~/chef-repo\par
\par
# knife client list\par
example-validator\par
If you execute this command on an existing chef workstation machine which already has several servers connected to it, you\rquote ll see a list of all the servers that are managed by the chef.\par
\par
In the following example, we see 5 servers connected to this chef workstation.\par
\par
# knife client list\par
example-validator\par
node1\par
node2\par
node3\par
node4\par
node5\par
\par
#############end######\par
cd ~chef-repo\par
knife cookbook upload cookbook_name(leran_chef_apache2)\par
for node\par
run this command from workstation\par
\par
knife bootstrap 172.31.30.153(Node_IP) --ssh-user mannan --ssh-password 'abcd@1234' --sudo --use-sudo-password --node-name ip-172-31-18-84 --run-list 'recipe[leran_chef_apache2]'\par
\par
\par
\par
\par
}
 